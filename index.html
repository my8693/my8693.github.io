<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"my8693.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MY">
<meta property="og:url" content="http://my8693.github.io/index.html">
<meta property="og:site_name" content="MY">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Yu Ma">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://my8693.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://my8693.github.io/2021/10/14/LIcense-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yu Ma">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/14/LIcense-server/" class="post-title-link" itemprop="url">License server</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-14 22:28:29" itemprop="dateCreated datePublished" datetime="2021-10-14T22:28:29+08:00">2021-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-15 10:00:14" itemprop="dateModified" datetime="2021-10-15T10:00:14+08:00">2021-10-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Study/" itemprop="url" rel="index"><span itemprop="name">Study</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="License-DOC"><a href="#License-DOC" class="headerlink" title="License DOC"></a>License DOC</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>This is a study of license server deployment. The structure of the license includes two parts: server and client. The server maintains a database with <strong>sqlite3</strong>. The server and client communicate with AES crypto method.</p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><p>Define an AES crypto method:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESHelper</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__inite__</span>(<span class="params">self, password, iv</span>):</span></span><br><span class="line">        <span class="comment">#Set the password and offset</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pkcs7padding</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="comment">#Pack the text to n*16 bytes</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pkcs7unpadding</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="comment">#Unpack the text</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="comment">#encrypt content and return</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="comment">#decrypt content and return</span></span><br></pre></td></tr></table></figure>
<p>Instantiate an AES crypto:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_client_crypto</span>():</span></span><br><span class="line">    <span class="comment">#Return an &quot;AESHelper&quot; instance with a fixed password and offset</span></span><br><span class="line">    <span class="keyword">return</span> AESHelper(<span class="string">&quot;f1231111111111gh&quot;</span>, <span class="string">&quot;f1231111111111gh&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><p>The server receives <strong>requests from client</strong> and verify whether the request <strong>is valid</strong>. If the client is valid for a license, the server will <strong>generate a license string</strong> and send to the client. The communication <strong>encryption</strong> is AES. Besides, the license generation is recorded in <strong>database</strong>.</p>
<p>The server command line:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python main.py</span><br></pre></td></tr></table></figure>
<p><strong>Directory:</strong></p>
<p>├───main.py                         # main file<br>├───utility.py                        # functions used in the main file<br>└───license_data.db           # database of license users</p>
<h3 id="Receive-requests-from-clients"><a href="#Receive-requests-from-clients" class="headerlink" title="Receive requests from clients"></a>Receive requests from clients</h3><p>Python can serve with package <strong>flask</strong>. We first define the router to get data from client:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/sendjson&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>():</span></span><br><span class="line">    <span class="comment">#Get encrypted request from client</span></span><br><span class="line">    <span class="comment">#Decrypt the request</span></span><br><span class="line">    <span class="comment">#Call function &quot;is_valid&quot; to verify whether the license request is valid</span></span><br><span class="line">    <span class="comment">#Return a license if valid, otherwise, return &quot;false&quot;</span></span><br><span class="line">    aes_code = server_client_crypto()</span><br><span class="line">    data_from_client = aes_code.decrypt(request.get_json())</span><br><span class="line">    data_from_client = json.loads(data_from_client) <span class="comment">#get dict</span></span><br><span class="line">    print(data_from_client)</span><br><span class="line">    response = Response(request.get_json())</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> is_valid(data_from_client)):</span><br><span class="line">        response.data = <span class="string">&#x27;false&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    return_data = generate_license(data_from_client)</span><br><span class="line">    response.data = aes_code.encrypt(return_data)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="Verify-validation-of-requests"><a href="#Verify-validation-of-requests" class="headerlink" title="Verify validation of requests"></a>Verify validation of requests</h3><p>The work flow of the verification is shown below:</p>
<ul>
<li>The data from client should have some keys. Check whether the data have all the specified keys.</li>
<li>Check whether the server MAC address is correct.</li>
<li>Check whether the client is requesting for a license for a valid software.</li>
<li>Check in database:<ul>
<li>Check the <strong>username</strong> and <strong>password</strong>.</li>
<li>Check whether the client is requesting a license for an existed device.</li>
<li>If the client is requesting for a license for a new device, check whether the user is valid for one more device.</li>
</ul>
</li>
<li>If distribute a license to the client, register in database.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_valid</span>(<span class="params">data_from_client</span>):</span></span><br><span class="line">    <span class="comment">#Check whether it&#x27;s valid for a license in database</span></span><br><span class="line">    keys_should_have = [<span class="string">&#x27;MAC&#x27;</span>, <span class="string">&#x27;SoftwareName&#x27;</span>, <span class="string">&#x27;ServerMac&#x27;</span>, <span class="string">&#x27;UserName&#x27;</span>, <span class="string">&#x27;Password&#x27;</span>, <span class="string">&#x27;DeviceID&#x27;</span>, <span class="string">&#x27;MachineName&#x27;</span>, <span class="string">&#x27;MachineID&#x27;</span>]</span><br><span class="line">    softwarenames = [<span class="string">&#x27;name0&#x27;</span>, <span class="string">&#x27;name1&#x27;</span>]</span><br><span class="line">    UserContents = [<span class="string">&#x27;MAC&#x27;</span>, <span class="string">&#x27;MachineName&#x27;</span>, <span class="string">&#x27;DeviceID&#x27;</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> keys_should_have:</span><br><span class="line">            data_from_client[key]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment">#check server mac</span></span><br><span class="line">    <span class="keyword">if</span>(data_from_client[<span class="string">&#x27;ServerMac&#x27;</span>] != get_mac_address()):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># find target software and record the column index</span></span><br><span class="line">    column_index = <span class="number">1</span></span><br><span class="line">    find_target_software = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> softwarenames:</span><br><span class="line">        column_index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(i == data_from_client[<span class="string">&#x27;SoftwareName&#x27;</span>]):</span><br><span class="line">            find_target_software = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> find_target_software):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#check db</span></span><br><span class="line">    valid_user = <span class="literal">False</span></span><br><span class="line">    db = sqlite3.connect(<span class="string">&quot;license_data.db&quot;</span>)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">    users = cursor.execute(<span class="string">&quot;SELECT * FROM LICENSE&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span>(row[<span class="number">0</span>] == data_from_client[<span class="string">&#x27;UserName&#x27;</span>]):</span><br><span class="line">            UserName = row[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span>(row[<span class="number">1</span>] == data_from_client[<span class="string">&#x27;Password&#x27;</span>]):</span><br><span class="line">                num_devices_max = row[column_index]</span><br><span class="line">                valid_user = <span class="literal">True</span></span><br><span class="line">    db.close()</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> valid_user):</span><br><span class="line">        print(<span class="string">&quot;invalid user&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment">#check whether the user is tring to create more devices than valid num_devices</span></span><br><span class="line">    db = sqlite3.connect(<span class="string">&quot;license_data.db&quot;</span>)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    devices = cursor.execute(<span class="string">&quot;SELECT * FROM &quot;</span> + UserName + <span class="string">&#x27;_&#x27;</span> + data_from_client[<span class="string">&#x27;SoftwareName&#x27;</span>])</span><br><span class="line">    registered_dives = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> device <span class="keyword">in</span> devices:</span><br><span class="line">        registered_dives += <span class="number">1</span></span><br><span class="line">        same_device = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(UserContents)):</span><br><span class="line">            <span class="keyword">if</span>(device[i] != data_from_client[UserContents[i]]):</span><br><span class="line">                print(device, data_from_client)</span><br><span class="line">                same_device = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(same_device):</span><br><span class="line">            db.close()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    print(registered_dives, num_devices_max)</span><br><span class="line">    <span class="keyword">if</span>(registered_dives &gt;= num_devices_max):<span class="comment">#registering more devices than max</span></span><br><span class="line">        db.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#register in database</span></span><br><span class="line">        cmd = <span class="string">&quot;INSERT INTO &quot;</span> + UserName + <span class="string">&#x27;_&#x27;</span> + data_from_client[<span class="string">&#x27;SoftwareName&#x27;</span>] + <span class="string">&#x27; (&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> cc <span class="keyword">in</span> UserContents:</span><br><span class="line">            cmd += cc + <span class="string">&#x27;,&#x27;</span></span><br><span class="line">        cmd = cmd[:-<span class="number">1</span>] + <span class="string">&#x27;) &#x27;</span> + <span class="string">&#x27;VALUES (&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> uc <span class="keyword">in</span> UserContents:</span><br><span class="line">            <span class="keyword">if</span>(uc.find(<span class="string">&#x27;ID&#x27;</span>) != -<span class="number">1</span>):</span><br><span class="line">                cmd += <span class="built_in">str</span>(data_from_client[uc]) + <span class="string">&#x27;,&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cmd += <span class="string">&#x27;\&#x27;&#x27;</span> + data_from_client[uc] + <span class="string">&#x27;\&#x27;,&#x27;</span></span><br><span class="line">        cmd = cmd[:-<span class="number">1</span>] + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">        print(cmd)</span><br><span class="line">        cursor.execute(cmd)</span><br><span class="line">        db.commit()</span><br><span class="line">        db.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h3 id="Database-operations"><a href="#Database-operations" class="headerlink" title="Database operations"></a>Database operations</h3><p>Assume we have two softwares: “name0” and “name1”. We first create table to record the users’ permission. The main table records the user and the number of devices the user can use.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>UserName</th>
<th>Password</th>
<th>software_name0</th>
<th>software_name1</th>
<th>…</th>
</tr>
</thead>
<tbody>
<tr>
<td>VARCHAR(255) NOT NULL</td>
<td>VARCHAR(255) NOT NULL</td>
<td>INT</td>
<td>INT</td>
<td>INT</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_database</span>():</span></span><br><span class="line">    <span class="comment">#Specify softwares manually</span></span><br><span class="line">    <span class="comment">#Create an empty table. Note that the columns of software_names record the number of devices the client can register</span></span><br><span class="line">    softwarenames = [<span class="string">&#x27;name0&#x27;</span>, <span class="string">&#x27;name1&#x27;</span>]</span><br><span class="line">    db = sqlite3.connect(<span class="string">&#x27;license_data.db&#x27;</span>)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    cmd = <span class="string">&#x27;CREATE TABLE LICENSE (UserName VARCHAR(255) NOT NULL,Password VARCHAR(255) NOT NULL&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sn <span class="keyword">in</span> softwarenames:</span><br><span class="line">        cmd += <span class="string">&#x27;,&#x27;</span> + sn + <span class="string">&#x27; INT NOT NULL&#x27;</span></span><br><span class="line">    cmd += <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    print(cmd)</span><br><span class="line">    cursor.execute(cmd)</span><br><span class="line">    db.commit()</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
<p>After adding a database, we can add users in the main table. Besides, in this demo, we create a table for each user for each software, <strong>UserName_SoftwareName</strong>. Every table for the user records device information the user has registered.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>MAC</th>
<th>MachineName</th>
<th>DeviceID</th>
</tr>
</thead>
<tbody>
<tr>
<td>VARCHAR(255) NOT NULL</td>
<td>VARCHAR(255) NOT NULL</td>
<td>INT</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_user</span>():</span></span><br><span class="line">    <span class="comment">#Add a user in the main table</span></span><br><span class="line">    <span class="comment">#Create an empty table for each software with specified title for the user</span></span><br><span class="line">    <span class="comment">#e.g. two empty tables: UserName_softwarename0, UserName_softwarename1</span></span><br><span class="line">    softwarenames = [<span class="string">&#x27;name0&#x27;</span>, <span class="string">&#x27;name1&#x27;</span>]</span><br><span class="line">    UserContents = [<span class="string">&#x27;MAC&#x27;</span>, <span class="string">&#x27;MachineName&#x27;</span>, <span class="string">&#x27;DeviceID&#x27;</span>]</span><br><span class="line">    NewUser = &#123;<span class="string">&#x27;name0&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;name1&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;UserName&#x27;</span>: <span class="string">&#x27;yma1&#x27;</span>, <span class="string">&#x27;Password&#x27;</span>: <span class="string">&#x27;pss&#x27;</span>&#125;</span><br><span class="line">    db = sqlite3.connect(<span class="string">&quot;license_data.db&quot;</span>)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    users = cursor.execute(<span class="string">&quot;SELECT * FROM license&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span>(user[<span class="number">0</span>] == NewUser[<span class="string">&#x27;UserName&#x27;</span>]):</span><br><span class="line">            db.close()</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Adding existed user.&quot;</span>)</span><br><span class="line">    <span class="comment">#cursor.execute(&quot;DROP TABLE yma1_name0&quot;)</span></span><br><span class="line">    <span class="comment">#cursor.execute(&quot;DROP TABLE yma1_name1&quot;)</span></span><br><span class="line">    cmd = <span class="string">&quot;INSERT INTO LICENSE (UserName,Password&quot;</span></span><br><span class="line">    <span class="keyword">for</span> sn <span class="keyword">in</span> softwarenames:</span><br><span class="line">        cmd += <span class="string">&#x27;,&#x27;</span>+ sn</span><br><span class="line">    cmd += <span class="string">&quot;) VALUES (\&#x27;&quot;</span> + NewUser[<span class="string">&#x27;UserName&#x27;</span>] + <span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span> + NewUser[<span class="string">&#x27;Password&#x27;</span>] + <span class="string">&#x27;\&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sn <span class="keyword">in</span> softwarenames:</span><br><span class="line">        cmd += <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(NewUser[sn])</span><br><span class="line">    cmd += <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    print(cmd)</span><br><span class="line">    cursor.execute(cmd)</span><br><span class="line">    <span class="keyword">for</span> sn <span class="keyword">in</span> softwarenames:</span><br><span class="line">        <span class="keyword">if</span>(NewUser[sn] &gt; <span class="number">0</span>):</span><br><span class="line">            cmd = <span class="string">&quot;CREATE TABLE &quot;</span> + NewUser[<span class="string">&#x27;UserName&#x27;</span>] + <span class="string">&#x27;_&#x27;</span> + sn + <span class="string">&#x27; (&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> uc <span class="keyword">in</span> UserContents:</span><br><span class="line">                cmd += uc</span><br><span class="line">                <span class="keyword">if</span>(uc.find(<span class="string">&#x27;ID&#x27;</span>) == -<span class="number">1</span>):</span><br><span class="line">                    cmd += <span class="string">&quot; VARCHAR(255)&quot;</span> + <span class="string">&#x27;,&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cmd += <span class="string">&quot; INT&quot;</span> + <span class="string">&#x27;,&#x27;</span></span><br><span class="line">            cmd = cmd[:-<span class="number">1</span>] + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">            print(cmd)</span><br><span class="line">            cursor.execute(cmd)</span><br><span class="line">    db.commit()</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
<p>Similarly, if we want to delete a user, we remove the tables created for the user and delete the information in table <strong>LICENSE</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_user</span>(<span class="params">UserName</span>):</span></span><br><span class="line">    <span class="comment">#Delete UserName in database include:</span></span><br><span class="line">    <span class="comment">#1. UserName in table license</span></span><br><span class="line">    <span class="comment">#2. UserName_SoftwareName Tables in database</span></span><br><span class="line">    softwarenames = [<span class="string">&#x27;name0&#x27;</span>, <span class="string">&#x27;name1&#x27;</span>]</span><br><span class="line">    NewUser = &#123;<span class="string">&#x27;name0&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;name1&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;UserName&#x27;</span>: <span class="string">&#x27;yma1&#x27;</span>, <span class="string">&#x27;Password&#x27;</span>: <span class="string">&#x27;pss&#x27;</span>&#125;</span><br><span class="line">    db = sqlite3.connect(<span class="string">&quot;license_data.db&quot;</span>)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd = <span class="string">&quot;DELETE FROM LICENSE where UserName=\&#x27;&quot;</span> + UserName + <span class="string">&#x27;\&#x27;&#x27;</span></span><br><span class="line">        print(cmd)</span><br><span class="line">        cursor.execute(cmd)</span><br><span class="line">        print(<span class="string">&quot;Success delete from license table.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;No specified user.&quot;</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> sn <span class="keyword">in</span> softwarenames:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cmd = <span class="string">&quot;DROP TABLE &quot;</span> + NewUser[<span class="string">&#x27;UserName&#x27;</span>] + <span class="string">&#x27;_&#x27;</span> + sn</span><br><span class="line">            print(cmd)</span><br><span class="line">            cursor.execute(cmd)</span><br><span class="line">            print(<span class="string">&quot;Success&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    db.commit()</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><p>Read <strong>yaml</strong> file to get the configurations. Then send the configuration and <strong>mac address</strong> to server to request and generate a license for every software. After that, execute <strong>update</strong> every hour.</p>
<p>The client command line:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.py -U user.yml -M 1 #user config and machineID</span><br></pre></td></tr></table></figure>
<p><strong>Directory:</strong></p>
<p>├───main.py                         # main file<br>├───utility.py                        # functions used in main file<br>└───user.yml                       # yaml file of user configuration</p>
<h3 id="Register-for-a-software"><a href="#Register-for-a-software" class="headerlink" title="Register for a software"></a>Register for a software</h3><p>The client register a software and get license with the <strong>register</strong> function. The client first get the configuration from file <strong>user.yml</strong> and devices information, e.g. MAC address. Then encrypt the information and send to server to request a license.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">SoftwareName, data</span>):</span></span><br><span class="line">    <span class="comment">#Send data to server and generate license file</span></span><br><span class="line">    <span class="comment">#&quot;Data&quot; is from yaml file</span></span><br><span class="line">    <span class="comment">#Generate data_for_server by calling function &quot;GetInfo&quot;</span></span><br><span class="line">    <span class="comment">#Send the data_for_server to server by calling function &quot;send_to_server&quot;</span></span><br><span class="line">    <span class="comment">#Write license file by calling function &quot;license_write_file&quot; (see 2.2)</span></span><br><span class="line">    data = GetInfo(SoftwareName, data)</span><br><span class="line">    license_content = send_to_server(data)</span><br><span class="line">    license_write_file(SoftwareName, license_content)</span><br><span class="line">    print(<span class="string">&quot;Successfully get license for &quot;</span> + SoftwareName + <span class="string">&quot;.&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetInfo</span>(<span class="params">SoftwareName, data</span>):</span></span><br><span class="line">    <span class="comment">#Return a dict containing &quot;data&quot;, MAC address, MachineName and SoftwareName</span></span><br><span class="line">    mac = get_mac_address()</span><br><span class="line">    data[<span class="string">&#x27;MAC&#x27;</span>] = mac</span><br><span class="line">    MachineName = socket.gethostname()</span><br><span class="line">    data[<span class="string">&#x27;MachineName&#x27;</span>] = MachineName</span><br><span class="line">    data[<span class="string">&#x27;SoftwareName&#x27;</span>] = SoftwareName</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_to_server</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">#Send data to server to request a license.</span></span><br><span class="line">    <span class="comment">#Exit if the server returns &quot;false&quot;.</span></span><br><span class="line">    <span class="comment">#Return license</span></span><br><span class="line">    aes_code = server_client_crypto()</span><br><span class="line">    data = json.dumps(data)</span><br><span class="line">    data = aes_code.encrypt(data)</span><br><span class="line">    headers2 = &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">    response = requests.post(url=<span class="string">&quot;http://localhost:8085/sendjson&quot;</span>, headers=headers2, json=data, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span>(response.content == <span class="string">b&#x27;false&#x27;</span>):</span><br><span class="line">        print(<span class="string">&quot;Fail! Check configure yaml file or contact administrator.&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> response.content</span><br></pre></td></tr></table></figure>
<p>Besides, we want the client to update the license every month. We check the license file to get the register data, If the date exceeds 30, the client delete the license and register again.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">updater</span>():</span></span><br><span class="line">    <span class="comment">#Check the data in the license and current date: d = current_date - license_date    	#Remove license files and call function &quot;register&quot; if d &gt;= 30.</span></span><br><span class="line">    SoftwareName = license_path[:-<span class="number">4</span>]</span><br><span class="line">    current_time = datetime.now()</span><br><span class="line">    license_content = license_parser(license_path)</span><br><span class="line">    license_time = license_content[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">    license_time = datetime.strptime(license_time, <span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line">    days_past = (current_time - license_time).days</span><br><span class="line">    <span class="keyword">if</span>(days_past &gt;= <span class="number">30</span>):</span><br><span class="line">        print(<span class="string">&quot;Update license.&quot;</span>)</span><br><span class="line">        os.remove(license_path)</span><br><span class="line">        register(SoftwareName, data)</span><br></pre></td></tr></table></figure>
<h3 id="Generate-license-file"><a href="#Generate-license-file" class="headerlink" title="Generate license file"></a>Generate license file</h3><p>After getting the encrypted license from server, generate license file locally. The license file contains <strong>10</strong> lines. The first three lines are <strong>junk</strong> strings including “Y”, “E” and “S” respectively. The index of “Y”, “E” and “S” in the first three lines determines which line the encrypted license string is located:</p>
<p>[index(“Y” in line0) +  index(“E” in line1) + index(“S” in line3)] % 7</p>
<p>For example, [1+1+1]%7=3. The license string will be stored in the seventh (3+3+1) line. The first “3” is the base index. The next “3” is the result of the computation. The other six lines are also junk strings containing “M”, “Y”, “Y”, “Y”, “D”, “S” respectively.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">license_write_file</span>(<span class="params">SoftwareName, content</span>):</span></span><br><span class="line">    <span class="comment">#&quot;content&quot;: the encrypted license string.</span></span><br><span class="line">    <span class="comment">#Generate license file for SoftwareName: SoftwareName.lic</span></span><br><span class="line">    fw = <span class="built_in">open</span>(SoftwareName+<span class="string">&#x27;.lic&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    length = <span class="built_in">len</span>(content)</span><br><span class="line">    generate_list = [<span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;S&#x27;</span>]</span><br><span class="line">    digit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generate_list:</span><br><span class="line">        ll = generate_junk(length, i)</span><br><span class="line">        fw.write(ll+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        digit += ll.find(i)</span><br><span class="line">    insert_line = digit % <span class="number">7</span></span><br><span class="line">    generate_list += [<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;S&#x27;</span>]</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        <span class="keyword">if</span>(i == insert_line):</span><br><span class="line">            fw.write(<span class="built_in">str</span>(content)[<span class="number">2</span>:-<span class="number">1</span>]+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fw.write(generate_junk(length, generate_list[index])+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">    fw.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_junk</span>(<span class="params">length, key</span>):</span></span><br><span class="line">    <span class="comment">#Generate a junk string which includes key with fixed length.</span></span><br><span class="line">    ll = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.printable[:-<span class="number">6</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length)])</span><br><span class="line">    <span class="keyword">if</span>(ll.find(key) == -<span class="number">1</span>):</span><br><span class="line">        ll = <span class="built_in">list</span>(ll)</span><br><span class="line">        ll[random.randint(<span class="number">0</span>,length-<span class="number">1</span>)] = key</span><br><span class="line">        ll = <span class="string">&#x27;&#x27;</span>.join((ll))</span><br><span class="line">    <span class="keyword">return</span> ll</span><br></pre></td></tr></table></figure>
<h3 id="License-parser"><a href="#License-parser" class="headerlink" title="License parser"></a>License parser</h3><p>Get license content from a license file. The string can be used to verify the validation of the license file for security. In this demo, I don’t realize it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">license_parser</span>(<span class="params">license_path</span>):</span></span><br><span class="line">    <span class="comment">#Read the first three lines and compute the license location (see 3.2).</span></span><br><span class="line">    <span class="comment">#Decrypt the license line.</span></span><br><span class="line">    generate_list = [<span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;S&#x27;</span>]</span><br><span class="line">    <span class="comment">#read license file and get license content</span></span><br><span class="line">    fr = <span class="built_in">open</span>(license_path)</span><br><span class="line">    digit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generate_list:</span><br><span class="line">        ll = fr.readline()</span><br><span class="line">        digit += ll.find(i)</span><br><span class="line">    insert_line = digit % <span class="number">7</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        ll = fr.readline()</span><br><span class="line">        <span class="keyword">if</span>(i == insert_line):</span><br><span class="line">            content = ll[:-<span class="number">1</span>].encode()</span><br><span class="line">    fr.close()</span><br><span class="line">    aes_code = server_client_crypto()</span><br><span class="line">    license_content = aes_code.decrypt(content)</span><br><span class="line">    <span class="keyword">return</span> json.loads(license_content)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://my8693.github.io/2021/01/03/spin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yu Ma">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/03/spin/" class="post-title-link" itemprop="url">Spin Electronics</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-03 22:28:06" itemprop="dateCreated datePublished" datetime="2021-01-03T22:28:06+08:00">2021-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-10 13:38:22" itemprop="dateModified" datetime="2020-10-10T13:38:22+08:00">2020-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Memory/" itemprop="url" rel="index"><span itemprop="name">Memory</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Memory/Spin/" itemprop="url" rel="index"><span itemprop="name">Spin</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="自旋电子器件"><a href="#自旋电子器件" class="headerlink" title="自旋电子器件"></a>自旋电子器件</h2><p>自旋电子器件可以作为内存候选器件之一，是一种非易失性(nonvolatile)存储器件，它可以用作存储也可以作为计算器件。<a href="/attach/spin/spin.pdf">相关总结点击此处</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://my8693.github.io/2021/01/03/rand_gen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yu Ma">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/03/rand_gen/" class="post-title-link" itemprop="url">Rndom Number Generator with LFSR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-03 22:28:06" itemprop="dateCreated datePublished" datetime="2021-01-03T22:28:06+08:00">2021-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-10 14:11:55" itemprop="dateModified" datetime="2020-10-10T14:11:55+08:00">2020-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hardware-Design/" itemprop="url" rel="index"><span itemprop="name">Hardware Design</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="真随机与伪随机"><a href="#真随机与伪随机" class="headerlink" title="真随机与伪随机"></a>真随机与伪随机</h2><p>真随机数是指我们完全无法预测的随机，比如利用电子自旋进行的设计。伪随机数的原因是输出的结果是有规律的，可以根据电路设计和生成算法进行预测。一般基于CMOS器件的电路设计中一般用到的是伪随机数发生器。伪随机数也有很多方法，比如：</p>
<ul>
<li>线性的乘法$out = a \times x + b$，其中$a$和$b$是两个定值，$x$ 作为种子（seed）。</li>
<li>每个时钟周期都自加1。</li>
</ul>
<p>考虑到硬件资源，更为简单的设计方案：LFSR。</p>
<h2 id="LFSR-Linear-Feedback-Shift-Registers"><a href="#LFSR-Linear-Feedback-Shift-Registers" class="headerlink" title="LFSR (Linear Feedback Shift Registers)"></a>LFSR (Linear Feedback Shift Registers)</h2><p>LFSR每一个时钟周期都可以输出一个数字序列，其方案如图所示：</p>
<p><img src="/attach/lfsr/lfsr.png" width="450" align=center/></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/01/03/rand_gen/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://my8693.github.io/2021/01/03/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yu Ma">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/03/mysql/" class="post-title-link" itemprop="url">MySQL基本操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-03 22:28:05" itemprop="dateCreated datePublished" datetime="2021-01-03T22:28:05+08:00">2021-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-15 19:53:23" itemprop="dateModified" datetime="2020-10-15T19:53:23+08:00">2020-10-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u username -p</span><br></pre></td></tr></table></figure>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p>显示存在的数据库：<code>show databases;</code></p>
<p>创建数据库：<code>create database name;</code></p>
<p>删除数据库：<code>drop database name;</code></p>
<p>选择数据库：<code>use name;</code></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/01/03/mysql/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://my8693.github.io/2021/01/03/latex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yu Ma">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/03/latex/" class="post-title-link" itemprop="url">LaTeX</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-03 22:28:05" itemprop="dateCreated datePublished" datetime="2021-01-03T22:28:05+08:00">2021-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-10 14:15:52" itemprop="dateModified" datetime="2020-10-10T14:15:52+08:00">2020-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LaTeX/" itemprop="url" rel="index"><span itemprop="name">LaTeX</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="主体"><a href="#主体" class="headerlink" title="主体"></a>主体</h2><p>本文总结LaTex的最基本用法。</p>
<p>从最简单的使用开始，以下便是最基本的文章结构：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\documentclass</span>&#123;article&#125; <span class="comment">%开始写一个article</span></span><br><span class="line"><span class="comment">%导言区</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;document&#125;</span><br><span class="line">	Hello world.</span><br><span class="line"><span class="keyword">\end</span>&#123;document&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/01/03/latex/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Yu Ma</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yu Ma</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
